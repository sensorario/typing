<html>
    <head>
        <style>
            #expected_letter {
                margin: auto;
                width: 40px;
                height: 40px;
                border: #ccc 1px solid;
                font-size: 40px;
                text-align: center;
                clear: both;
            }
            #selected_sentece {
                margin: auto;
                width: 800px;
            }
            div.left {
                font-weight: bold;
                font-family: verdana;
            }
            div.inline {
                font-size: 40px;
                float: left;
                width: 40px;
                height: 40px;
                border-bottom: #ccc 1px solid;
                margin: 5px;
                text-align: center;
            }
        </style>
    </head>
    <body>

        <div id="expected_letter"></div>
        <div id="selected_sentece"></div>

        <script>
            window.onload = function (e) {
                let app = {
                    status : 'wait_for_key_down',
                }

                const sentences = [];
                sentences.push('Glib jocks quiz nymph to vex dwarf.');
                sentences.push('How vexingly quick daft zebras jump!');
                sentences.push('Jived fox nymph grabs quick waltz.');
                sentences.push('Pack my box with five dozen liquor jugs.');
                sentences.push('Sphinx of black quartz, judge my vow.');
                sentences.push('The five boxing wizards jump quickly.');
                sentences.push('The quick brown fox jumps over the lazy dog.');

                let sentence = sentences[Math.floor(Math.random()*sentences.length)];
                let lasKeyLetter = null;
                let el = window.document.querySelector('#selected_sentece');
                let targetIndex = 0;
                let position = 0;

                document.querySelector('#expected_letter').innerText = sentence[targetIndex];

                for (item of sentence) {
                    let buildElement = document.createElement('div');
                    buildElement.append(item);
                    buildElement.classList.add('inline');
                    buildElement.id = 'letter_' + position;
                    el.append(buildElement);
                    position++;
                }

                window.addEventListener('keydown', function (event) {
                    if (app.status === 'wait_for_key_down') {
                        if (
                            event.keyCode >= 65 && event.keyCode <= 90
                            || event.keyCode === 32 // " "
                            || event.keyCode === 49 // "!"
                            || event.keyCode === 8 // "backslash"
                            || event.keyCode === 188 // ","
                            || event.keyCode === 190 // "."
                        ) {
                            lasKeyLetter = event.keyCode;
                            app.status = 'key_pressed';
                        } else {
                            if (
                                event.keyCode !== 16 // "Shift"
                                && event.keyCode !== 9 // "Tab"
                            ) {
                                console.log(
                                    'unhexpected ' + event.keyCode + ' (' + event.key + ')'
                                );
                            }
                        }
                    }

                    if (app.status === 'key_pressed') {
                        if (event.key == sentence[targetIndex]) {
                            app.status = 'wait_for_key_down';
                            document.querySelector('#letter_' + targetIndex).classList.add('left');
                            targetIndex++;
                            document.querySelector('#expected_letter').innerText = sentence[targetIndex];
                        } else {
                            console.log(
                                'expected ' + sentence[targetIndex]
                                + ' but got ' + event.key
                            );
                        }
                    }

                    if (event.keyCode === 8) {
                        targetIndex--;
                        document.querySelector('#letter_' + targetIndex).classList.remove('left');
                    }

                    if (sentence.length == targetIndex) {
                        document.location.reload();
                    }
                });

            }
        </script>

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149384970-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-149384970-1');
        </script>

    </body>
</html>
