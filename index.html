<html>
    <head>
        <link rel="stylesheet" type="text/css" href="app.css" />
    </head>
    <body>

        <div id="expected_letter"></div>
        <div id="selected_sentece"></div>
        <div id="wrong_letters"></div>

        <script>
            window.onload = function (e) {

                const sentences = [];
                sentences.push('Glib jocks quiz nymph to vex dwarf.');
                sentences.push('How vexingly quick daft zebras jump!');
                sentences.push('Jived fox nymph grabs quick waltz.');
                sentences.push('Pack my box with five dozen liquor jugs.');
                sentences.push('Sphinx of black quartz, judge my vow.');
                sentences.push('The five boxing wizards jump quickly.');
                sentences.push('The quick brown fox jumps over the lazy dog.');

                let status = 'wait_for_key_down';
                let sentence = sentences[Math.floor(Math.random()*sentences.length)];
                let lasKeyLetter = null;
                let el = window.document.querySelector('#selected_sentece');
                let targetIndex = 0;
                let position = 0;

                document.querySelector('#expected_letter').innerText = sentence[targetIndex];

                for (item of sentence) {
                    let buildElement = document.createElement('div');
                    buildElement.append(item);
                    buildElement.classList.add('inline');
                    buildElement.id = 'letter_' + position;
                    el.append(buildElement);
                    position++;
                }

                window.addEventListener('keydown', function (event) {
                    if (status === 'wait_for_key_down') {
                        if (
                            event.keyCode >= 65 && event.keyCode <= 90
                            || event.keyCode === 32 // " "
                            || event.keyCode === 49 // "!"
                            || event.keyCode === 8 // "backslash"
                            || event.keyCode === 188 // ","
                            || event.keyCode === 190 // "."
                        ) {
                            lasKeyLetter = event.keyCode;
                            status = 'key_pressed';
                        } else {
                            if (
                                event.keyCode !== 16 // "Shift"
                                && event.keyCode !== 9 // "Tab"
                            ) {
                                console.log(
                                    'unhexpected ' + event.keyCode + ' (' + event.key + ')'
                                );
                            }
                        }
                    }

                    if (status === 'key_pressed') {
                        if (event.key == sentence[targetIndex]) {
                            status = 'wait_for_key_down';
                            document.querySelector('#letter_' + targetIndex).classList.add('left');
                            targetIndex++;
                            document.querySelector('#expected_letter').innerText = sentence[targetIndex];
                        } else {
                            let id = 'wrong_letter_' + sentence[targetIndex];
                            if (!document.getElementById(id)) {
                                let err = document.createElement('div')
                                err.id = id;
                                err.innerText = sentence[targetIndex];
                                let wl = window.document.querySelector('#wrong_letters');
                                wl.append(err);
                            }
                        }
                    }

                    if (event.keyCode === 8) {
                        targetIndex--;
                        document.querySelector('#letter_' + targetIndex).classList.remove('left');
                    }

                    if (sentence.length == targetIndex) {
                        document.location.reload();
                    }
                });

            }
        </script>

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149384970-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-149384970-1');
        </script>

    </body>
</html>
